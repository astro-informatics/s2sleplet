services:
    - docker

before_install:
    - >
        echo ${DOCKER_PASSWORD} |
        docker login
        -u ${DOCKER_USERNAME}
        --password-stdin

install:
    - >
        docker build
        -f docker/Dockerfile
        --build-arg DOCKER_USERNAME=${DOCKER_USERNAME}
        --build-arg DOCKER_IMAGE=${DOCKER_IMAGE}
        -t IMAGE
        .

before_script:
    - >
        docker run
        --name CONTAINER
        -t
        -d IMAGE

script:
    - >
        docker exec CONTAINER pytest -v
